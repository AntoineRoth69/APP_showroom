import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation
import matplotlib.animation as animation
import numpy as np
import time
import json

from sklearn.cluster import DBSCAN
from sklearn.preprocessing import StandardScaler
from sklearn.preprocessing import normalize
from sklearn.decomposition import PCA
from sklearn import metrics
from sklearn.datasets import make_blobs
from sklearn import decomposition
from sklearn import datasets

import paho.mqtt.client as mqtt
# variable de comptage pour getMesure
nbValues = 0

# Successful Connection Callback
def on_connect(client, userdata, flags, rc):
    print('Connected with result code '+str(rc))
    client.subscribe('\showroom\Lidar')

tab=[]
# Message delivery callback
def on_message(client, userdata, msg):
    global nbValues
    print(nbValues)
    message = str(msg.payload.decode("utf-8"))
    #print(message)
    json_msg = json.loads(message)
    to_append=[]
    for json_obj in json_msg:
        keys = list(json_obj.keys())
        to_append.append(json_obj.get(keys[0]))
    tab.append(to_append)
    nbValues = nbValues + 1

def append_limit(value, list):
    if(len(list)>=15):
        del list[0]
    list.append(value)

def getMesure(n): # n= nombre de mesure à mettre dans res
    # on ne prends les valeurs que lors de l'appel de la fonction
    global nbValues
    client.loop_start()
    while True:
        if n==nbValues :
            break
    client.loop_stop()
    return tab # tab = [ [angle, distance],......., [angle, distance], [angle, distance],] de sorte que len (res)=n


"""         Traitement des données         """
def PolarToCart(angle,distance):
    x = distance*np.cos(angle*((2*np.pi)/360))
    y = distance*np.sin(angle*((2*np.pi)/360))
    return [x,y]

def animate(i, xs, ys):
    # Limit x and y lists to 20 items
    #xs = xs[-20:]
    #ys = ys[-20:]

    # Draw x and y lists
    ax.clear()
    ax.scatter(xs, ys)

    # Format plot
    plt.xticks(rotation=45, ha='right')
    plt.subplots_adjust(bottom=0.30)
    plt.title('Lidar')
    plt.ylabel('Distance')

def dbscan(res):
    # Numpy array of all the cluster labels assigned to each data point
    res = np.array(res)
    std = StandardScaler()
    X = std.fit_transform(res)
    db = DBSCAN(eps=0.2, min_samples=20).fit(X)
    core_samples_mask = np.zeros_like(db.labels_, dtype=bool)
    core_samples_mask[db.core_sample_indices_] = True
    labels = db.labels_
    data = std.inverse_transform(X)
    # Number of clusters in labels, ignoring noise if present.
    n_clusters_ = len(set(labels)) - (1 if -1 in labels else 0)
    n_noise_ = list(labels).count(-1)
    # Black removed and is used for noise instead.
    unique_labels = set(labels)
    results, cart, temp = [], [], []
    for k in zip(unique_labels):
        class_member_mask = labels == k
        Scluster = std.inverse_transform(X[class_member_mask & core_samples_mask])
        results.append(Scluster)
       
    return results


##########################################################################################################
client = mqtt.Client()

# Set callback handler
client.on_connect = on_connect
client.on_message = on_message

# Set up connection
client.connect('10.100.100.117', 443, 60)
# Publish message
client.publish('\showroom\Lidar',payload='SUR',qos=0)


# valeur en continu
#client.loop_forever()

#print(getMesure(10))


t=time.time()








plt.ion()



while True:
    print("debut")
    res=[[338.296875, 5792.75], [46.546875, 5663.25], [47.84375, 5600.75], [49.140625, 5508.25], [50.4375, 5391.25], [51.765625, 5302.5], [53.0625, 5201.75], [54.375, 5126.5], [55.671875, 4996.75], [56.96875, 4957.0], [58.34375, 4857.0], [59.65625, 4793.25], [60.96875, 4733.25], [62.265625, 4695.5], [63.578125, 4625.75], [64.890625, 4581.75], [66.1875, 4538.5], [67.5, 4482.75], [68.796875, 4447.0], [70.109375, 4386.25], [71.421875, 4359.0], [72.71875, 4325.25], [74.03125, 4297.0], [75.328125, 4278.0], [76.640625, 4233.5], [77.9375, 4215.0], [79.25, 4201.5], [80.5625, 4161.75], [81.875, 4161.75], [83.171875, 4132.5], [84.46875, 4135.75], [85.765625, 4134.25], [87.0625, 4111.75], [88.375, 4116.5], [89.6875, 4121.25], [91.0, 4114.75], [92.296875, 4116.5], [93.578125, 4123.0], [94.90625, 4126.0], [96.1875, 4137.5], [97.5, 4139.0], [98.78125, 4157.0], [100.09375, 4175.0], [101.390625, 4193.25], [102.703125, 4213.25], [104.015625, 4247.0], [105.3125, 4272.75], [106.390625, 8746.25], [107.6875, 8782.25], [108.984375, 8775.0], [112.90625, 7565.75], [114.203125, 7149.5], [115.53125, 6962.5], [116.84375, 6579.75], [118.15625, 6329.5], [119.46875, 6059.5], [120.765625, 5811.75], [122.09375, 5580.25], [123.390625, 5407.5], [124.734375, 4646.0], [126.046875, 4603.5], [127.359375, 4542.25], [128.640625, 4498.0], [129.9375, 4503.75], [131.21875, 4589.5], [132.40625, 7316.25], [133.6875, 7517.75], [134.984375, 7592.75], [136.265625, 7798.5], [137.5625, 7961.75], [138.859375, 8322.5], [140.15625, 8454.75], [141.4375, 8584.25], [145.59375, 3444.5], [146.90625, 3280.5], [148.234375, 3123.75], [149.546875, 2980.5], [150.859375, 2864.5], [152.203125, 2744.75], [153.421875, 3277.25], [154.796875, 3247.25], [156.109375, 3209.75], [157.390625, 3192.5], [158.71875, 3160.0], [160.046875, 3128.25], [161.34375, 3096.25], [162.625, 3075.75], [163.953125, 3058.75], [165.25, 3039.5], [166.578125, 3023.75], [167.875, 3016.0], [169.171875, 2996.5], [170.46875, 2985.5], [171.796875, 2882.25], [173.09375, 2866.75], [174.390625, 2866.0], [175.703125, 2850.5], [176.984375, 2845.25], [178.3125, 2836.75], [179.59375, 2840.5], [180.90625, 2839.0], [182.203125, 2852.0], [183.5, 2898.0], [184.796875, 2941.5], [186.078125, 2949.0], [187.390625, 2953.0], [188.6875, 2978.75], [189.96875, 2978.0], [191.296875, 2892.5], [192.59375, 2895.75], [193.875, 2933.5], [195.203125, 2939.0], [196.46875, 2960.5], [197.78125, 2978.0], [199.0625, 3000.0], [208.21875, 3218.5], [209.484375, 3263.25], [217.46875, 2383.5], [218.765625, 2306.0], [220.109375, 2242.0], [221.453125, 2189.0], [222.75, 2130.25], [224.078125, 2089.25], [225.375, 2037.75], [226.75, 1994.0], [228.0625, 1951.5], [229.40625, 1912.75], [230.671875, 1879.0], [232.015625, 1828.25], [233.359375, 1821.0], [234.671875, 1799.0], [235.953125, 1782.0], [237.25, 1764.25], [238.609375, 1740.25], [239.90625, 1731.0], [241.21875, 1726.0], [242.484375, 1716.75], [243.84375, 1697.25], [245.109375, 1691.5], [246.453125, 1684.5], [247.71875, 1677.5], [249.078125, 1669.25], [250.71875, 1210.5], [252.0625, 1185.75], [253.34375, 1163.25], [254.671875, 1165.0], [257.1875, 1201.25], [259.5, 1666.75], [260.8125, 1667.75], [262.125, 1684.5], [263.359375, 1690.25], [264.6875, 1694.5], [266.03125, 1696.5], [267.328125, 1721.0], [268.609375, 1728.0], [269.890625, 1743.5], [271.1875, 1761.25], [272.484375, 1771.75], [273.8125, 1799.0], [275.015625, 1818.25], [276.296875, 1835.75], [277.5625, 1861.0], [278.84375, 1875.75], [280.140625, 1909.5], [281.421875, 1944.5], [282.71875, 1972.0], [284.015625, 2001.0], [285.3125, 2030.0], [286.59375, 2078.5], [287.859375, 2126.5], [289.140625, 2177.25], [290.453125, 2234.5], [291.734375, 2298.0], [293.015625, 2373.5], [294.265625, 2449.5], [295.5625, 2525.0], [296.84375, 2610.75], [298.109375, 2712.5], [299.40625, 2825.5], [300.6875, 2911.75], [302.015625, 2963.75], [303.3125, 3005.75], [304.609375, 3047.25], [305.875, 3088.25], [307.1875, 3159.0], [308.453125, 3208.0], [309.75, 3252.25], [311.046875, 3320.5], [312.328125, 3388.5], [313.640625, 3460.25], [314.921875, 3536.5], [316.234375, 3617.5], [317.515625, 3709.0], [318.796875, 3778.0], [320.078125, 3886.5], [321.375, 4010.25], [322.703125, 4123.0], [324.0, 4240.25], [325.296875, 4377.0], [326.578125, 4530.75], [327.890625, 4699.5], [329.171875, 4848.0], [330.453125, 5070.5], [331.75, 5279.0], [333.046875, 5519.5], [334.328125, 5755.25], [335.625, 5739.75], [336.953125, 5654.25], [338.234375, 5789.5], [339.53125, 5818.0], [340.84375, 5773.75], [342.140625, 5712.0], [343.453125, 5681.5], [344.765625, 5654.25], [346.0625, 5603.75], [347.328125, 5586.25], [348.640625, 5562.75], [349.953125, 5505.25], [351.234375, 5499.75], [352.546875, 5485.5], [353.859375, 5465.75], [355.140625, 5435.25], [356.453125, 5454.5], [357.75, 5424.0], [359.03125, 5438.0], [0.34375, 5440.75], [1.65625, 5424.0], [2.953125, 5415.75], [4.265625, 5451.75], [5.5625, 5204.25], [6.875, 5209.25], [8.15625, 5217.0], [9.46875, 5242.5], [10.703125, 5281.5], [21.03125, 6637.0], [22.328125, 6401.75], [23.625, 6237.0], [24.9375, 5789.5], [26.25, 5761.25], [27.515625, 5853.25], [28.828125, 5915.0], [30.125, 5994.75], [31.40625, 6083.75], [32.703125, 6143.5], [34.0, 6229.5], [35.375, 6303.25], [36.671875, 6421.0], [37.96875, 6523.25], [39.265625, 6543.25], [40.578125, 6382.5], [41.890625, 6215.0], [43.1875, 6076.75], [44.484375, 5978.0], [45.796875, 5792.75], [47.109375, 5684.5], [48.421875, 5548.25], [49.71875, 5449.0], [51.03125, 5353.25], [52.328125, 5255.5], [53.640625, 5156.25], [54.9375, 5037.0], [56.25, 4968.5], [57.5625, 4899.5], [58.921875, 4810.5], [60.203125, 4765.25], [61.53125, 4710.0], [62.828125, 4633.75], [64.15625, 4601.5], [65.453125, 4558.0], [66.75, 4511.5], [68.046875, 4454.5], [69.359375, 4426.5], [70.6875, 4377.0], [71.984375, 4344.75], [73.296875, 4314.5], [74.59375, 4276.25], [75.890625, 4264.25], [77.21875, 4223.25], [78.5, 4193.25], [79.828125, 4186.5], [81.109375, 4168.5], [82.40625, 4147.25], [83.703125, 4147.25], [85.015625, 4129.25], [86.3125, 4121.25], [87.625, 4116.5], [88.921875, 4110.0], [90.234375, 4129.25], [91.515625, 4127.75], [92.8125, 4111.75], [94.140625, 4129.25], [95.4375, 4129.25], [96.734375, 4129.25], [98.03125, 4139.0], [99.328125, 4171.75], [100.625, 4171.75], [101.921875, 4203.25], [103.234375, 4231.75], [104.53125, 4252.25], [106.921875, 8746.25], [108.234375, 8804.0], [114.734375, 7101.75], [116.0625, 6729.25], [117.359375, 6464.0], [118.671875, 6175.5], [119.984375, 5948.0], [121.3125, 5693.5], [122.59375, 5514.0], [123.9375, 4701.75], [125.25, 4619.75], [126.5625, 4595.5], [127.859375, 4523.0], [129.15625, 4507.5], [130.453125, 4591.5], [131.734375, 4619.75], [132.921875, 7367.0], [134.21875, 7533.75], [135.515625, 7680.25], [136.796875, 7891.0], [138.09375, 8039.75], [139.390625, 8355.25], [140.6875, 8448.0], [141.984375, 8639.75], [144.828125, 3501.5], [146.140625, 3369.0], [147.46875, 3210.75], [148.796875, 3072.0], [150.109375, 2928.5], [151.390625, 2818.75], [152.71875, 2734.25], [153.9375, 3257.25], [155.265625, 3230.5], [156.578125, 3208.0], [157.90625, 3182.75], [159.21875, 3155.25], [160.5, 3116.5], [161.796875, 3091.0], [163.109375, 3063.25], [164.4375, 3047.25], [165.734375, 3023.75], [167.015625, 3017.0], [168.328125, 2994.0], [169.640625, 2986.25], [170.9375, 2983.75], [172.25, 2867.5], [173.546875, 2867.5], [174.84375, 2851.25], [176.140625, 2846.0], [177.4375, 2844.5], [178.796875, 2840.5], [180.09375, 2852.75], [181.390625, 2852.0], [182.6875, 2838.25], [183.953125, 2943.25], [185.25, 2945.75], [186.59375, 2939.0], [187.859375, 2963.0], [189.171875, 2974.5], [190.5, 2898.0], [191.765625, 2899.75], [193.078125, 2910.75], [194.375, 2950.5], [195.671875, 2944.75], [196.96875, 2971.25], [198.25, 2982.25], [199.5625, 3011.0], [200.875, 3025.5], [202.15625, 3072.0], [207.359375, 3222.5], [208.65625, 3246.25], [209.953125, 3262.25], [216.625, 2428.0], [217.96875, 2365.75], [219.296875, 2287.75], [220.578125, 2225.0], [221.890625, 2174.25], [223.234375, 2120.25], [224.53125, 2068.75], [225.875, 2021.75], [227.15625, 1977.75], [228.484375, 1943.0], [229.78125, 1899.0], [231.109375, 1864.25], [232.4375, 1832.0], [233.765625, 1814.25], [235.0625, 1794.25], [236.375, 1772.25], [237.640625, 1751.0], [239.0, 1735.5], [240.328125, 1726.5], [241.59375, 1723.25], [242.921875, 1712.75], [244.234375, 1697.0], [245.5, 1691.5], [246.8125, 1684.0], [248.09375, 1670.5], [249.4375, 1667.75], [251.015625, 1206.25], [252.4375, 1169.75], [255.0, 1158.0], [259.828125, 1664.75], [261.140625, 1672.5], [262.453125, 1683.25], [263.734375, 1691.25], [265.046875, 1695.5], [266.328125, 1702.25], [267.59375, 1721.75], [268.921875, 1730.0], [270.25, 1746.5], [271.53125, 1766.75], [272.828125, 1775.5], [274.09375, 1801.25], [275.296875, 1822.75], [276.609375, 1840.5], [277.90625, 1865.75], [279.1875, 1893.5], [280.4375, 1916.0], [281.71875, 1947.0], [283.046875, 1977.25], [284.328125, 2015.0], [285.578125, 2050.0], [286.890625, 2093.25], [288.171875, 2135.25], [289.421875, 2190.5], [290.734375, 2244.75], [292.0, 2316.75], [293.28125, 2387.25], [294.5625, 2467.25], [295.84375, 2536.25], [297.109375, 2634.25], [298.375, 2740.0], [299.703125, 2856.0], [301.0, 2936.75], [302.3125, 2972.0], [303.59375, 3011.0], [304.890625, 3064.0], [306.171875, 3110.0], [307.484375, 3163.75], [308.75, 3214.75], [310.0625, 3273.25], [311.34375, 3333.0], [312.625, 3408.0], [313.921875, 3478.5], [315.203125, 3561.5], [316.5, 3635.0], [317.796875, 3722.0], [319.0625, 3804.0], [320.375, 3921.0], [321.65625, 4048.75], [322.96875, 4157.0], [324.28125, 4257.25], [325.5625, 4419.0], [326.84375, 4560.0], [328.125, 4706.0], [329.421875, 4906.5], [330.71875, 5131.5], [332.0, 5345.25], [333.296875, 5539.75], [334.59375, 5773.75], [335.90625, 5708.75], [337.1875, 5675.5], [338.484375, 5882.25], [339.78125, 5786.5], [341.09375, 5739.75], [342.40625, 5687.5], [343.6875, 5669.5], [345.015625, 5657.25], [346.296875, 5603.75], [347.53125, 5577.5], [348.84375, 5562.75], [350.140625, 5545.5], [351.453125, 5488.25], [352.75, 5460.25], [354.046875, 5449.0], [355.34375, 5424.0], [356.640625, 5429.5], [357.9375, 5424.0], [359.234375, 5449.0], [0.53125, 5415.75], [1.828125, 5424.0], [3.125, 5440.75], [4.421875, 5279.0], [5.734375, 5206.75], [7.015625, 5181.5], [8.328125, 5219.5], [9.625, 5227.25], [10.859375, 5279.0], [19.84375, 7356.75], [21.15625, 6620.5], [22.46875, 6363.5], [23.765625, 6101.25], [25.0625, 5770.75], [26.359375, 5789.5], [27.65625, 5879.0], [28.953125, 5944.5], [30.234375, 6015.0], [31.53125, 6073.25], [32.8125, 6154.0], [34.109375, 6226.0], [35.5, 6352.25], [36.796875, 6432.75], [38.09375, 6539.25], [39.390625, 6527.25], [40.703125, 6382.5], [42.0, 6207.75], [43.3125, 6070.0], [44.625, 5941.25], [45.9375, 5795.75], [47.234375, 5663.25], [48.53125, 5562.75], [49.828125, 5446.25], [51.140625, 5347.75], [52.4375, 5227.25], [53.734375, 5139.0], [55.046875, 5046.5], [56.359375, 4975.5], [57.640625, 4902.0], [59.015625, 4848.0], [60.3125, 4776.0], [61.625, 4703.75], [62.90625, 4652.25], [64.21875, 4579.75], [65.53125, 4550.25], [66.84375, 4521.0], [68.15625, 4477.0], [69.453125, 4422.75], [70.75, 4377.0], [72.0625, 4339.25], [73.359375, 4314.5], [74.671875, 4298.75], [75.96875, 4257.25], [77.265625, 4248.75], [78.578125, 4221.5], [79.875, 4194.75], [81.171875, 4168.5], [82.4375, 4140.75], [83.71875, 4150.5], [85.046875, 4129.25], [86.34375, 4118.0], [87.640625, 4119.75], [88.953125, 4114.75], [90.234375, 4119.75], [91.53125, 4116.5], [92.828125, 4123.0], [94.140625, 4121.25], [95.421875, 4123.0], [96.734375, 4134.25], [98.015625, 4150.5], [99.328125, 4155.25], [100.640625, 4165.0], [101.921875, 4203.25], [103.234375, 4221.5], [104.515625, 4278.0], [106.90625, 8796.75], [108.203125, 8855.25], [110.8125, 8495.0], [112.125, 7867.5], [114.734375, 7092.25], [116.03125, 6699.75], [117.34375, 6452.25], [118.65625, 6211.5], [119.953125, 5941.25], [121.265625, 5718.0], [122.578125, 5525.25], [123.90625, 4718.5], [125.234375, 4611.5], [126.53125, 4601.5], [127.8125, 4530.75], [129.109375, 4501.75], [130.390625, 4587.75], [131.6875, 4623.75], [132.875, 7351.75], [134.171875, 7512.5], [135.46875, 7680.25], [136.75, 7920.25], [138.046875, 8283.75], [139.328125, 8355.25], [140.640625, 8495.0], [141.9375, 8632.75], [146.078125, 3368.0], [147.40625, 3218.5], [148.71875, 3073.0], [150.015625, 2923.0], [151.328125, 2827.0], [152.671875, 2734.25], [153.875, 3252.25], [155.203125, 3226.5], [156.5, 3208.0], [157.8125, 3188.5], [159.109375, 3156.25], [160.40625, 3112.75], [161.703125, 3080.25], [163.015625, 3066.75], [164.296875, 3054.5], [165.609375, 3036.0], [166.9375, 3016.0], [168.203125, 3002.5], [169.515625, 2996.5], [170.8125, 2973.0], [172.125, 2873.75], [173.421875, 2858.25], [174.734375, 2852.0], [176.046875, 2852.75], [177.328125, 2839.75], [178.609375, 2846.75], [179.90625, 2836.0], [181.203125, 2830.75], [182.515625, 2854.25], [183.78125, 2940.75], [185.078125, 2938.25], [186.375, 2955.5], [187.671875, 2963.75], [188.953125, 2980.5], [190.25, 2982.25], [191.578125, 2898.0], [192.84375, 2903.75], [194.140625, 2945.75], [195.46875, 2941.5], [196.75, 2961.25], [198.046875, 2986.25], [199.34375, 3005.75], [207.1875, 3210.75], [208.46875, 3248.25], [209.78125, 3265.25], [217.75, 2377.25], [219.0625, 2292.75], [220.390625, 2235.0], [221.71875, 2178.5], [223.03125, 2124.75], [224.359375, 2080.0], [225.640625, 2026.75], [227.0, 1990.0], [228.3125, 1948.0], [229.609375, 1903.75], [230.96875, 1870.0], [232.28125, 1828.5], [233.546875, 1818.75], [234.859375, 1799.5], [236.171875, 1781.5], [237.515625, 1757.75], [238.828125, 1746.25], [240.109375, 1730.0], [241.40625, 1721.75], [242.703125, 1710.75], [244.03125, 1698.25], [245.328125, 1690.5], [246.65625, 1683.0], [247.984375, 1675.25], [249.28125, 1667.5], [250.9375, 1206.75], [252.15625, 1180.25], [253.46875, 1163.25], [254.78125, 1160.25], [257.359375, 1201.25], [259.59375, 1666.25], [260.921875, 1669.5], [262.171875, 1687.0], [263.46875, 1691.0], [264.8125, 1693.75], [266.09375, 1700.25], [267.34375, 1722.0], [268.640625, 1730.0], [269.921875, 1745.0], [271.234375, 1757.5], [272.5625, 1770.75], [273.84375, 1793.0], [275.015625, 1817.75], [276.3125, 1838.0], [277.59375, 1862.25], [278.859375, 1883.25], [280.140625, 1909.5], [281.453125, 1944.75], [282.71875, 1972.75], [284.03125, 1999.75], [285.28125, 2032.0], [286.546875, 2085.75], [287.828125, 2128.25], [289.109375, 2177.25], [290.40625, 2235.0], [291.671875, 2299.5], [292.96875, 2373.5], [294.203125, 2449.5], [295.5, 2525.0], [296.796875, 2603.0], [298.03125, 2710.5], [299.40625, 2829.25], [300.703125, 2910.0], [301.96875, 2962.25], [303.296875, 3005.75], [304.59375, 3049.0], [305.859375, 3092.75], [307.140625, 3158.25], [308.453125, 3209.75], [309.734375, 3251.25], [311.03125, 3315.25], [312.328125, 3384.0], [313.59375, 3454.75], [314.90625, 3540.0], [316.203125, 3612.5], [317.46875, 3706.5], [318.765625, 3771.25], [320.046875, 3889.25], [321.34375, 4008.75], [322.65625, 4121.25], [323.953125, 4236.75], [325.21875, 4371.75], [326.515625, 4513.25], [327.796875, 4695.5], [329.09375, 4845.75], [330.390625, 5051.25], [331.671875, 5250.25], [332.953125, 5511.0], [334.234375, 5752.0], [335.53125, 5752.0], [336.84375, 5684.5], [338.140625, 5795.75], [339.4375, 5818.0], [340.734375, 5755.25], [342.046875, 5702.75], [343.328125, 5672.5], [344.65625, 5663.25], [345.9375, 5627.5], [347.15625, 5606.75], [348.453125, 5565.75], [349.75, 5542.5], [351.0625, 5496.75], [352.34375, 5468.5], [353.640625, 5446.25], [354.921875, 5435.25], [356.21875, 5435.25], [357.53125, 5429.5], [358.8125, 5440.75], [0.125, 5449.0], [1.40625, 5424.0], [2.703125, 5446.25], [3.984375, 5435.25], [5.296875, 5189.0], [6.609375, 5196.5], [7.890625, 5204.25], [9.1875, 5245.25], [10.453125, 5289.5], [14.1875, 10739.75], [19.421875, 7609.0], [22.046875, 6440.5], [23.34375, 6136.25], [24.640625, 5869.25], [25.9375, 5733.5], [27.234375, 5827.5], [28.53125, 5901.75], [29.8125, 5991.5], [31.09375, 6052.75], [32.390625, 6115.25], [33.671875, 6218.75], [35.09375, 6310.75], [36.375, 6409.5], [37.6875, 6487.5], [38.96875, 6583.75], [40.265625, 6405.75], [41.578125, 6262.5], [42.890625, 6132.75], [44.171875, 5998.25], [45.484375, 5846.75], [46.78125, 5696.75], [48.09375, 5586.25], [49.40625, 5505.25], [50.703125, 5364.0], [52.0, 5266.0], [53.3125, 5174.0], [54.625, 5089.75], [55.921875, 4987.25], [57.21875, 4927.0], [58.53125, 4854.75], [59.84375, 4793.25], [61.15625, 4724.75], [62.453125, 4670.5], [63.765625, 4607.5], [65.046875, 4552.25], [66.34375, 4515.25], [67.640625, 4484.75], [68.953125, 4437.75], [70.265625, 4397.0], [71.5625, 4348.25], [72.875, 4312.75], [74.171875, 4293.5], [75.46875, 4264.25], [76.765625, 4247.0], [78.0625, 4215.0], [79.359375, 4193.25], [80.65625, 4185.0], [81.984375, 4161.75], [83.25, 4126.0], [84.546875, 4129.25], [85.828125, 4134.25], [87.140625, 4114.75], [88.4375, 4126.0], [89.71875, 4108.5], [91.015625, 4095.75], [92.3125, 4118.0], [93.609375, 4119.75], [94.890625, 4123.0], [96.203125, 4111.75], [97.5, 4139.0], [98.78125, 4144.0], [100.09375, 4173.25], [101.40625, 4199.75], [102.671875, 4215.0], [103.984375, 4225.0], [105.265625, 4252.25], [106.421875, 8639.75], [107.703125, 8768.0], [109.0, 8833.25], [112.921875, 7576.5], [114.21875, 7168.75], [115.546875, 6948.75], [116.84375, 6567.5], [118.140625, 6348.5], [119.453125, 6059.5], [120.765625, 5808.5], [122.078125, 5574.5], [123.390625, 5399.25], [124.71875, 4654.25], [126.03125, 4603.5], [127.328125, 4544.25], [128.640625, 4519.0], [129.90625, 4500.0], [131.203125, 4585.75], [132.390625, 7321.5], [133.6875, 7517.75], [134.984375, 7652.75], [136.265625, 7787.0], [137.546875, 8021.75], [138.859375, 8309.5], [140.15625, 8368.25], [141.4375, 8584.25], [142.734375, 8818.75], [145.578125, 3459.25], [146.875, 3303.0], [148.203125, 3122.0], [149.53125, 2991.5], [150.859375, 2860.5], [152.15625, 2749.25], [153.40625, 3278.25], [154.703125, 3236.25], [155.984375, 3215.75], [157.28125, 3200.25], [158.59375, 3160.0], [159.890625, 3126.5], [161.203125, 3103.5], [162.484375, 3082.0], [163.8125, 3050.75], [165.09375, 3048.25], [166.40625, 3025.5], [167.703125, 3009.25], [169.0, 2994.0], [170.3125, 2986.25], [171.59375, 2894.25], [172.890625, 2871.5], [174.1875, 2856.75], [175.515625, 2853.5], [176.796875, 2848.25], [178.078125, 2845.25], [179.4375, 2839.75], [180.71875, 2833.0], [182.03125, 2853.5], [183.3125, 2848.25], [184.609375, 2949.75], [185.921875, 2935.75], [187.1875, 2952.25], [188.515625, 2967.0], [189.796875, 2978.75], [191.109375, 2896.5], [192.390625, 2899.0], [193.703125, 2944.75], [194.984375, 2943.25], [196.28125, 2963.0], [198.875, 3005.0], [200.1875, 3023.75], [205.421875, 3125.5], [209.296875, 3254.25], [217.28125, 2396.75], [218.59375, 2330.25], [219.921875, 2255.0], [221.265625, 2192.5], [222.578125, 2136.0], [223.859375, 2096.25], [225.171875, 2044.25], [226.5, 2008.75], [227.84375, 1958.25], [229.15625, 1923.75], [230.4375, 1885.0], [231.765625, 1848.5], [233.09375, 1820.75], [234.40625, 1804.25], [235.734375, 1777.25], [237.046875, 1763.5], [238.3125, 1749.25], [239.671875, 1733.5], [240.953125, 1725.25], [242.28125, 1718.75], [243.53125, 1701.5], [244.875, 1696.0], [246.15625, 1687.0], [247.46875, 1678.0], [248.796875, 1668.25], [250.453125, 1220.75], [254.390625, 1163.75], [256.921875, 1193.25], [260.5, 1668.75], [261.765625, 1672.25], [263.0625, 1687.0], [264.359375, 1691.5], [265.640625, 1697.75], [266.984375, 1716.0], [268.234375, 1727.25], [269.546875, 1739.25], [270.8125, 1757.0], [272.15625, 1770.5], [273.4375, 1792.75], [274.6875, 1810.75], [276.015625, 1826.0], [277.28125, 1856.75], [278.578125, 1874.0], [279.875, 1903.25], [281.140625, 1935.25], [282.40625, 1959.5], [283.703125, 1997.0], [285.0, 2027.5], [286.296875, 2068.25], [287.5625, 2117.0], [288.859375, 2168.5], [290.140625, 2224.5], [291.421875, 2285.5], [292.703125, 2355.0], [293.96875, 2430.25], [295.265625, 2506.75], [296.546875, 2579.25], [297.828125, 2692.5], [299.125, 2796.25], [300.40625, 2901.25], [301.703125, 2948.0], [303.0, 2993.0], [304.28125, 3029.0], [305.5625, 3088.25], [306.859375, 3142.25], [308.15625, 3204.0], [309.4375, 3256.25], [310.734375, 3307.0], [312.0, 3371.25], [313.296875, 3445.75], [314.59375, 3529.5], [315.890625, 3601.5], [317.1875, 3685.75], [318.484375, 3764.5], [319.765625, 3863.75], [321.0625, 3980.0], [322.375, 4100.5], [323.640625, 4215.0], [324.953125, 4334.0], [326.234375, 4498.0], [327.53125, 4658.25], [328.8125, 4817.25], [330.109375, 4989.5], [331.390625, 5227.25], [332.6875, 5438.0], [333.984375, 5663.25], [335.28125, 5745.75], [336.59375, 5705.75], [337.890625, 5727.25], [339.171875, 5853.25], [340.484375, 5777.0], [341.78125, 5733.5], [343.09375, 5693.5], [344.390625, 5663.25], [345.703125, 5618.5], [346.9375, 5595.0], [348.25, 5571.5], [349.546875, 5522.5], [350.859375, 5505.25], [352.15625, 5468.5], [353.453125, 5454.5], [354.75, 5449.0], [356.046875, 5429.5], [357.34375, 5449.0], [358.640625, 5446.25], [359.9375, 5449.0], [1.234375, 5440.75], [2.546875, 5418.5], [3.8125, 5435.25], [5.140625, 5196.5], [6.4375, 5214.5], [7.734375, 5237.5], [9.03125, 5250.25], [10.3125, 5271.25], [19.3125, 7582.0], [21.921875, 6479.75], [23.234375, 6125.75], [24.546875, 5869.25], [25.84375, 5770.75], [27.15625, 5837.0], [28.4375, 5901.75], [29.734375, 5958.0], [31.03125, 6052.75], [32.328125, 6108.25], [33.625, 6200.5], [34.96875, 6310.75], [36.28125, 6421.0], [37.5625, 6495.5], [38.859375, 6628.75], [40.171875, 6428.75], [41.46875, 6325.75], [42.78125, 6129.25], [44.078125, 5984.75], [45.375, 5850.0], [46.703125, 5693.5], [48.0, 5595.0], [49.3125, 5502.5], [50.609375, 5388.5], [51.921875, 5279.0], [53.234375, 5191.5], [54.515625, 5073.0], [55.828125, 5001.25], [57.125, 4938.5], [58.453125, 4868.0], [59.734375, 4802.0], [61.046875, 4746.0], [62.34375, 4672.75], [63.65625, 4619.75], [64.953125, 4560.0], [66.265625, 4525.0], [67.578125, 4496.0], [68.875, 4445.0], [70.171875, 4389.75], [71.484375, 4359.0], [72.765625, 4323.5], [74.09375, 4300.5], [75.375, 4260.75], [76.6875, 4247.0], [78.0, 4221.5], [79.296875, 4209.75], [80.59375, 4189.75], [81.890625, 4175.0], [83.140625, 4147.25], [84.453125, 4131.0], [85.75, 4123.0], [87.046875, 4123.0], [88.34375, 4123.0], [89.671875, 4114.75], [90.953125, 4103.75], [92.25, 4118.0], [93.5625, 4126.0], [94.828125, 4123.0], [96.15625, 4132.5], [97.4375, 4150.5], [98.75, 4155.25], [100.03125, 4180.0], [101.34375, 4173.25], [102.640625, 4216.5], [103.921875, 4260.75], [105.21875, 4279.75], [106.359375, 8661.0], [107.65625, 8746.25], [108.953125, 8855.25], [112.890625, 7587.25], [114.171875, 7168.75], [115.484375, 6962.5], [116.796875, 6608.25], [118.109375, 6340.75], [119.421875, 6073.25], [120.71875, 5802.25], [122.03125, 5574.5], [123.328125, 5435.25], [124.6875, 4644.0], [126.0, 4603.5], [127.28125, 4558.0], [128.578125, 4525.0], [129.875, 4500.0], [131.140625, 4587.75], [132.328125, 7256.5], [133.625, 7496.5], [134.921875, 7603.5], [136.21875, 7815.5], [137.5, 7967.75], [138.796875, 8270.75], [140.078125, 8448.0], [141.375, 8556.5], [142.671875, 8789.5], [145.515625, 3446.75], [146.8125, 3305.0], [148.15625, 3128.25], [149.46875, 3011.75], [150.78125, 2873.75], [152.109375, 2759.75], [153.3125, 3285.5], [154.65625, 3234.25], [155.953125, 3218.5], [157.21875, 3200.25], [158.546875, 3164.75], [159.859375, 3128.25], [161.125, 3098.25], [162.453125, 3070.25], [163.734375, 3058.0], [165.046875, 3046.5], [166.34375, 3024.75], [167.640625, 3015.25], [168.953125, 2999.0], [170.25, 2981.25], [171.578125, 2883.0], [172.859375, 2873.0], [174.15625, 2851.25], [175.46875, 2852.0], [176.75, 2849.75], [178.0625, 2835.25], [179.375, 2834.5], [180.671875, 2848.25], [181.96875, 2836.0], [183.28125, 2842.0], [184.578125, 2948.0], [185.84375, 2940.75], [187.140625, 2951.5], [188.453125, 2968.75], [189.734375, 2983.0], [191.0625, 2887.0], [192.34375, 2899.75], [193.640625, 2906.0], [194.953125, 2953.0], [196.234375, 2952.25], [197.546875, 2967.0], [200.140625, 3005.75], [209.28125, 3252.25], [217.25, 2401.5], [218.578125, 2318.25], [219.875, 2257.0], [221.21875, 2193.0], [222.515625, 2137.0], [223.875, 2093.25], [225.15625, 2058.5], [226.5, 2010.5], [227.75, 1967.0], [229.09375, 1923.75], [230.375, 1892.25], [231.703125, 1852.0], [233.03125, 1822.0], [234.328125, 1805.75], [235.625, 1776.75], [236.921875, 1760.5], [238.265625, 1750.0], [239.59375, 1735.75], [240.875, 1723.5], [242.1875, 1715.75], [243.5, 1700.5], [244.8125, 1693.75], [246.078125, 1687.75], [247.359375, 1676.75], [248.71875, 1674.25], [251.625, 1191.75], [254.265625, 1155.25], [255.609375, 1154.25], [256.84375, 1189.0], [259.0625, 1665.5], [260.375, 1667.0], [261.640625, 1677.75], [262.953125, 1687.75], [264.234375, 1694.75], [265.546875, 1706.25], [266.828125, 1711.75], [268.09375, 1727.0], [269.40625, 1734.25], [270.75, 1756.25], [272.015625, 1766.75], [273.28125, 1792.5], [274.578125, 1805.5], [275.828125, 1829.25], [277.125, 1853.25], [278.390625, 1872.75], [279.6875, 1901.0], [280.953125, 1937.5], [282.25, 1956.25], [283.53125, 1992.25], [284.796875, 2024.5], [286.109375, 2067.5], [287.390625, 2117.0], [288.671875, 2165.5], [289.953125, 2219.5], [291.234375, 2268.25], [292.515625, 2352.5], [293.8125, 2413.25], [295.09375, 2501.5], [296.34375, 2568.25], [297.609375, 2681.0], [298.984375, 2785.25], [300.25, 2895.75], [301.53125, 2949.0], [302.828125, 2989.0], [304.140625, 3045.5], [305.421875, 3085.5], [306.703125, 3122.0], [308.0, 3193.5], [309.296875, 3240.25], [310.59375, 3308.0], [311.890625, 3370.0], [313.1875, 3432.25], [314.46875, 3523.5], [315.734375, 3585.75], [317.046875, 3674.25], [318.34375, 3752.5], [319.625, 3863.75], [320.921875, 3972.5], [322.203125, 4086.25], [323.46875, 4206.5], [324.75, 4321.75], [326.0625, 4463.75], [327.328125, 4627.75], [328.625, 4780.25], [329.90625, 4966.25], [331.1875, 5181.5], [332.484375, 5410.25], [333.78125, 5624.5], [335.0625, 5758.25], [336.375, 5702.75], [337.671875, 5736.5], [338.953125, 5866.0], [340.25, 5786.5], [341.5625, 5745.75], [342.859375, 5684.5], [344.140625, 5672.5], [345.453125, 5624.5], [346.703125, 5595.0], [348.0, 5565.75], [349.296875, 5536.75]]
    print(np.shape(res))
    print("mesures = ", res)
    cluster = dbscan(res)
    print("cluster = ", np.shape(cluster))
    fig = plt.figure(1)
    ax = fig.add_subplot(1, 1, 1)
    for i in range(len(cluster)-1):
        m = cluster[i]
        ax.scatter(m[:, 0], m[:, 1])
        fig.canvas.draw()
    print("fin")






nbValues = 0

    










